"use strict";

window.addEventListener('DOMContentLoaded', function () {
  // Hamburger
  var menu = document.querySelector('.header-menu'),
      menuItem = document.querySelectorAll('.header-menu__item'),
      hamburger = document.querySelector('.header-hamburger');
  hamburger.addEventListener('click', function () {
    hamburger.classList.toggle('header-hamburger_active');
    menu.classList.toggle('header-menu_active');
  });
  menuItem.forEach(function (item) {
    item.addEventListener('click', function () {
      hamburger.classList.toggle('header-hamburger_active');
      menu.classList.toggle('header-menu_active');
    });
  }); // Popup

  var popupTrig = document.querySelectorAll('[data-popup]'),
      popupMoreTrig = document.querySelectorAll('[data-more]'),
      popup = document.querySelector('.popup'),
      popupMore = document.querySelector('.popup_more'),
      inputs = document.querySelectorAll('.inputfile'),
      popupCloseBtn = document.querySelectorAll('[data-close]');

  function openPopup() {
    popup.classList.add('show');
    popup.classList.remove('hide');
    document.body.style.overflow = 'hidden';
  }

  popupTrig.forEach(function (btn) {
    btn.addEventListener('click', openPopup);
  });

  function openPopupMore() {
    popupMore.classList.add('show');
    popupMore.classList.remove('hide');
    document.body.style.overflow = 'hidden';
  }

  popupMoreTrig.forEach(function (btn) {
    btn.addEventListener('click', openPopupMore);
  });

  function closePopup() {
    popup.classList.add('hide');
    popup.classList.remove('show');
    document.body.style.overflow = '';
  }

  popupCloseBtn.forEach(function (close) {
    close.addEventListener('click', closePopup);
  });

  function closePopupMore() {
    popupMore.classList.add('hide');
    popupMore.classList.remove('show');
    document.body.style.overflow = '';
  }

  popupCloseBtn.forEach(function (close) {
    close.addEventListener('click', closePopupMore);
  }); // Form 

  var forms = document.querySelectorAll('form');
  forms.forEach(function (item) {
    postData(item);
  });

  function postData(form) {
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      var request = new XMLHttpRequest();
      request.open('POST', 'PopupCrudController.php');
      request.setRequestHeader('Content-type', 'application/json; charset=utf-8');
      var formData = new FormData(form);
      var object = {};
      formData.forEach(function (value, key) {
        object[key] = value;
      });
      var json = JSON.stringify(object);
      request.send(json);
    });
  }
});